# Version: 1.0.17
# üß™ to test : pending
# Appartement: Tous
blueprint:
  name: "üß†üå°Ô∏è VT Scheduler Recalculate"
  description: >
    Version: 1.0.17
    Force un rafra√Æchissement du Versatile Thermostat pour appliquer le mode attendu par son scheduler.
    Peut aussi √™tre ex√©cut√© manuellement via le bouton "Ex√©cuter" dans Home Assistant.
  domain: automation
  input:
    thermostat:
      name: üå°Ô∏è Versatile Thermostat
      description: Entit√© climate du Versatile Thermostat
      selector:
        entity:
          domain: climate
          integration: versatile_thermostat

mode: single

trigger:
  # V√©rification p√©riodique: laisse le VT s'aligner sur son scheduler
  - platform: time_pattern
    id: periodic
    minutes: "/5"

  # Au d√©marrage de Home Assistant
  - platform: homeassistant
    id: ha_start
    event: start

action:
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ trigger is defined and trigger.platform is defined and trigger.platform == 'manual' }}"
        sequence:
          - service: logbook.log
            data:
              name: "VT Scheduler"
              message: "‚ñ∂Ô∏è Recalculate lanc√© manuellement"

  # Note: le service versatile_thermostat.recalculate n'existe pas dans certaines versions.
  # Un update_entity est un fallback s√ªr et l√©ger.
  - service: homeassistant.update_entity
    target:
      entity_id: !input thermostat
